å®Œå…¨åŒæ„ï¼š**æ”¹æ¥å£æ˜¯å”¯ä¸€æ­£ç¡®ã€å¯æŒç»­ã€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆ**ã€‚

ç»§ç»­åœ¨â€œå­—ç¬¦ä¸²æ‹¼æ¥ + ç©ºæ ¼åˆ†å‰²â€çš„æ—§æ¨¡å‹ä¸Šæ‰“è¡¥ä¸ï¼Œåªä¼šç§¯ç´¯æŠ€æœ¯å€ºã€åˆ¶é€ é™·é˜±ã€è®©ç”¨æˆ·å›°æƒ‘ã€‚è€Œ**é‡æ„è¾“å…¥æ¥å£**ï¼Œè™½ç„¶çŸ­æœŸéœ€è¦ä¸€ç‚¹è¿ç§»æˆæœ¬ï¼Œä½†æ¢æ¥çš„æ˜¯ï¼š

- âœ… **çœŸæ­£çš„å®‰å…¨æ€§**ï¼ˆæœç»å‘½ä»¤æ³¨å…¥ï¼‰
- âœ… **å®Œæ•´çš„åŠŸèƒ½æ”¯æŒ**ï¼ˆç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦ã€Unicodeï¼‰
- âœ… **æ¸…æ™°çš„è¯­ä¹‰**ï¼ˆå‚æ•°æ˜¯å‚æ•°ï¼Œä¸æ˜¯ shell ç‰‡æ®µï¼‰
- âœ… **å¯ç»´æŠ¤æ€§**ï¼ˆæ— éœ€ hack å¼çš„è¿‡æ»¤æˆ–è½¬ä¹‰ï¼‰

---

### ğŸ›  å¦‚ä½•ä¼˜é›…åœ°æ”¹æ¥å£ï¼Ÿï¼ˆå¹³æ»‘è¿ç§»ç­–ç•¥ï¼‰

#### ç¬¬ä¸€æ­¥ï¼š**æ–°å¢ç»“æ„åŒ–è¾“å…¥å­—æ®µ**
åœ¨ `action.yml` ä¸­æ·»åŠ ä¸€ä¸ªæ–°è¾“å…¥ï¼Œæ¯”å¦‚ï¼š

```yaml
inputs:
  extra-make-args:
    description: |
      Extra arguments for `make`, as a JSON array of strings.
      Supports spaces and special characters.
      Example: '["LOCALVERSION= (CI)", "KBUILD_EXTRA_SYMBOLS=/path/with spaces/file.sym"]'
    required: false
    default: '[]'
```

> ğŸ’¡ å­—æ®µåé¿å…ç”¨ `extra-cmd`ï¼ˆå®¹æ˜“æ··æ·†ï¼‰ï¼Œç”¨ `extra-make-args` æˆ– `make-args` æ›´å‡†ç¡®ã€‚

---

#### ç¬¬äºŒæ­¥ï¼š**åœ¨è„šæœ¬ä¸­ä¼˜å…ˆä½¿ç”¨æ–°å­—æ®µ**
```bash
# ä¼˜å…ˆä½¿ç”¨æ–°çš„ JSON è¾“å…¥
if [[ "${{ inputs.extra-make-args }}" != "[]" ]]; then
  readarray -t EXTRA_ARGS < <(jq -r '.[]' <<< "${{ inputs.extra-make-args }}")
elif [[ -n "${{ inputs.extra-cmd }}" ]]; then
  # å›é€€åˆ°æ—§å­—æ®µï¼ˆä½†åŠ è­¦å‘Šï¼‰
  echo "::warning::'extra-cmd' is deprecated. Use 'extra-make-args' (JSON array) to support spaces."
  if [[ "${{ inputs.extra-cmd }}" == *" "* ]]; then
    echo "::error::'extra-cmd' does not support spaces. Migrate to 'extra-make-args'."
    exit 1
  fi
  read -r -a EXTRA_ARGS <<< "${{ inputs.extra-cmd }}"
else
  EXTRA_ARGS=()
fi
```

---

#### ç¬¬ä¸‰æ­¥ï¼š**æ–‡æ¡£æ˜ç¡®å¼•å¯¼**
åœ¨ README ä¸­å†™æ¸…æ¥šï¼š

> âš ï¸ **`extra-cmd` is deprecated**  
> It does not support values with spaces and may be removed in v2.  
> âœ… **Use `extra-make-args` instead**:
> ```yaml
> - uses: your-action@v1
>   with:
>     extra-make-args: |
>       [
>         "LOCALVERSION= (CI #123)",
>         "KBUILD_EXTRA_SYMBOLS=/path/with spaces/symbols.sym"
>       ]
> ```

---

#### ç¬¬å››æ­¥ï¼ˆå¯é€‰ï¼‰ï¼š**v2 ç‰ˆæœ¬å½»åº•ç§»é™¤æ—§å­—æ®µ**
å½“å¤§å¤šæ•°ç”¨æˆ·å·²è¿ç§»åï¼Œå‘å¸ƒ `v2`ï¼Œç§»é™¤ `extra-cmd`ï¼Œåªä¿ç•™å®‰å…¨çš„ `extra-make-args`ã€‚

---

### âœ… æ”¹æ¥å£çš„å¥½å¤„è¿œå¤§äºæˆæœ¬

| æˆæœ¬ | æ”¶ç›Š |
|------|------|
| ç”¨æˆ·éœ€æ”¹ä¸€è¡Œ YAMLï¼ˆåŠ  `[]` å’Œæ¢è¡Œï¼‰ | æ°¸ä¹…è§£å†³ç©ºæ ¼ã€æ³¨å…¥ã€è§£æé”™è¯¯é—®é¢˜ |
| éœ€å†™å‡ è¡Œ `jq` è§£æä»£ç  | è„šæœ¬æ›´å¥å£®ã€å¯æµ‹è¯•ã€ç¬¦åˆ POSIX |
| éœ€æ›´æ–°æ–‡æ¡£ | ç”¨æˆ·ä½“éªŒæ›´æ¸…æ™°ã€ä¸“ä¸š |

è€Œä¸”ï¼Œ**GitHub Actions ç”Ÿæ€ä¸­å·²æœ‰å¤§é‡ Action é‡‡ç”¨ JSON æ•°ç»„è¾“å…¥**ï¼Œç”¨æˆ·å¹¶ä¸é™Œç”Ÿï¼š

- [`actions/upload-artifact`](https://github.com/actions/upload-artifact): `path: '["file1", "file with space"]'`
- [`docker/build-push-action`](https://github.com/docker/build-push-action): æ”¯æŒ JSON æ ¼å¼çš„ `build-args`

---

### ğŸ’¬ æœ€åä¸€å¥

> **â€œå…¼å®¹æ€§ä¸è¯¥æˆä¸ºå®‰å…¨å’Œæ­£ç¡®æ€§çš„æ·é”ã€‚â€**

ä½ æ„¿æ„ä¸ºé•¿æœŸå¥åº·è€Œæ”¹æ¥å£ï¼Œè¿™æ­£æ˜¯ä¼˜ç§€å¼€æºç»´æŠ¤è€…çš„è¡¨ç°ã€‚ç”¨æˆ·ä¼šæ„Ÿè°¢ä½ â€”â€”å“ªæ€•ä»–ä»¬ä¸€å¼€å§‹è¦å¤šæ•²å‡ ä¸ªå­—ç¬¦ã€‚

**æ”¹å§ï¼Œå€¼å¾—ã€‚** âœ…



actions: feat(build): replace extra-cmd with structured extra-make-args

Deprecate the unsafe string-based `extra-cmd` input, which cannot
correctly handle values containing spaces (e.g., LOCALVERSION="my build")
and is prone to argument corruption due to naive word splitting.

Introduce a new `extra-make-args` input that accepts a JSON array of
strings, enabling safe and reliable passing of make arguments with
arbitrary characters, including spaces, quotes, and special symbols.

Example usage:
  extra-make-args: |
    [
      "LOCALVERSION= (CI #123)",
      "KBUILD_EXTRA_SYMBOLS=/path/with spaces/symbols.sym"
    ]

The old `extra-cmd` is still supported for backward compatibility but
emits a deprecation warning. It now explicitly fails if spaces are
detected to prevent silent misbehavior.

This change eliminates ShellCheck SC2124 issues, prevents potential
command injection vectors, and aligns the action with modern GitHub
Actions best practices for structured input.

Signed-off-by: dabao1955 <dabao1955@163.com>